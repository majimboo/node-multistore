'use strict';

var purr     = module.exports;
var packer   = require('./lib/purr/packer');
var unpacker = require('./lib/purr/unpacker');
var ext      = require('./lib/purr/ext');

// Wraps func in to an async call
function wrapSync(func, cb) {
  if (typeof cb !== 'function') {
    return func();
  }

  process.nextTick(function () {
    var result;
    var error;

    try {
      result = func();
    } catch (err) {
      error = err;
    }

    return cb(error, result);
  });
}

purr.pack = function (obj, cb) {
  return wrapSync(function () {
    return packer.Packer(obj);
  }, cb);
};

purr.unpack = function (obj, cb) {
  return wrapSync(function () {
    return unpacker.Unpacker(obj);
  }, cb);
};

purr.Date     = ext.Date;
purr.DateTime = ext.DateTime;
purr.Time     = ext.Time;
