var vmDate = require('vm').runInNewContext('Date');

function Date() {
  if(!(this instanceof Date)) {
    return Date.apply(Object.create(Date.prototype), arguments);
  }

  var d = new vmDate();

  switch(arguments.length) {
    case 1:
      d = new vmDate(arguments[0]);
      break;
    case 3: case 4: case 5: case 6: case 7:
      d = new vmDate(arguments[0], arguments[1], arguments[2],
                     arguments[3] || null,
                     arguments[4] || null,
                     arguments[5] || null,
                     arguments[6] || null);
      break;
    default:
      // do nothing
  }

  // set to midnight
  d.setHours(0,0,0,0);
  d.nanoseconds = 0;

  return d;
}

Date.prototype = vmDate.prototype;
Date.prototype.type = 2;

Date.prototype.getNanoseconds = function() {
  return this.nanoseconds;
}

Date.prototype.setNanoseconds = function(ns) {
  this.setMilliseconds(Math.floor(ns / 1000000));
  this.nanoseconds = ns;
}

exports.Date = Date;
